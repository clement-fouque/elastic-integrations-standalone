# NGINX Integration Configuration Example
#
# This configuration collects NGINX access and error logs.
# To use this in Fleet:
#   1. Go to Kibana → Fleet → Integrations
#   2. Search for "NGINX"
#   3. Click "Add NGINX"
#   4. Use the settings below as reference

# NGINX Access Logs Configuration
nginx_access_logs:
  enabled: true
  
  # Log file paths
  paths:
    - /var/log/nginx/access.log*
    
  # Grok patterns for parsing
  processors:
    - add_fields:
        target: ''
        fields:
          service.type: nginx
          
    - decode_json_fields:
        fields: ['message']
        target: ''
        overwrite_keys: true
        
  # Parse log format
  # Default NGINX log format:
  # '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent"'
  
# NGINX Error Logs Configuration
nginx_error_logs:
  enabled: true
  
  # Log file paths
  paths:
    - /var/log/nginx/error.log*
    
  # Multiline pattern for stack traces
  multiline:
    pattern: '^[0-9]{4}/[0-9]{2}/[0-9]{2}'
    negate: true
    match: after
    
  processors:
    - add_fields:
        target: ''
        fields:
          service.type: nginx
          log.level: error

# NGINX Metrics Configuration
nginx_metrics:
  enabled: false
  period: 10s
  
  # NGINX stub_status endpoint
  hosts:
    - "http://nginx-sample:80/nginx_status"
    
  # Metrics to collect
  server_status:
    enabled: true

# Data Stream Configuration
data_streams:
  - type: logs
    dataset: nginx.access
  - type: logs
    dataset: nginx.error
  - type: metrics
    dataset: nginx.stubstatus
